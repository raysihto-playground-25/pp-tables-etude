# User Story-Driven Development Handbook

本ドキュメントは、ユーザーストーリー駆動開発に関する一般的・汎用的な概念を定義する。ストーリーカード、完成の定義 (DoD: Definition of Done)、受け入れ条件 (AC: Acceptance Criteria) など、ユーザーストーリーを中心とした開発プロセスの中核要素を網羅する。これらは本プロジェクトを支える確定事項として、プロジェクト固有の仕様とは独立して管理される。

---

## 目次

1. [ユーザーストーリー駆動開発の全体像](#ユーザーストーリー駆動開発の全体像)
2. [ストーリーカードの位置づけ](#ストーリーカードの位置づけ)
3. [ストーリーカードのフォーマット要素](#ストーリーカードのフォーマット要素)
4. [完成の定義 (DoD: Definition of Done)](#完成の定義-dod-definition-of-done)
5. [受け入れ条件 (AC: Acceptance Criteria)](#受け入れ条件-ac-acceptance-criteria)
6. [ユーザーロール運用ガイドライン](#ユーザーロール運用ガイドライン)
7. [PBI (Product Backlog Item) の概念](#pbi-product-backlog-item-の概念)
8. [5W2H フレームワークとの関係性](#5w2h-フレームワークとの関係性)

---

## ユーザーストーリー駆動開発の全体像

### ユーザーストーリー駆動開発とは

ユーザーストーリー駆動開発は、**ユーザー価値を中心に据えた開発手法**である。ユーザーストーリーを起点として、要求定義、開発、検証、完成判定までを一貫して管理する。

### 構成要素の関係性

ユーザーストーリー駆動開発は、以下の3つの主要要素で構成される：

```
ユーザーストーリー (PBI)
  ├── ストーリーカード: 「誰が・何を・なぜ」を表現
  ├── 完成の定義 (DoD): 「ストーリー横断の完成基準」を定義
  │     └── 条件の一つ: すべての受け入れ条件 (AC) が満たされること
  └── 受け入れ条件 (AC): 「個々のストーリー固有の完成条件」を定義
```

#### 1. ストーリーカード (Story Card)

- **目的**: ユーザー視点での価値を表現する
- **形式**: `{role} は、 {action} したい。 {benefit} のために。`
- **役割**: 開発の目的と方向性を示す

#### 2. 完成の定義 (DoD: Definition of Done)

- **目的**: すべてのストーリーに共通する品質基準を定義する
- **形式**: プロジェクト全体で合意された完成条件のリスト
- **役割**: 品質の一貫性確保と「完成」の共通認識
- **重要**: DoDの必須条件の一つとして「すべての受け入れ条件 (AC) が満たされること」が含まれる

#### 3. 受け入れ条件 (AC: Acceptance Criteria)

- **目的**: 個々のストーリーが完成したと判断する具体的な条件を定義する
- **形式**: 検証可能なチェックリストや Given-When-Then シナリオ
- **役割**: 開発スコープの明確化と受け入れテストの基準

### 各要素の使い分け

| 要素 | スコープ | 記述内容 | 適用レベル |
|------|---------|---------|-----------|
| ストーリーカード | ユーザー価値 | 誰が・何を・なぜ | 個別ストーリー |
| DoD (完成の定義) | 品質基準・プロセス | どんな品質で完成か | プロジェクト共通 (ストーリー横断) |
| AC (受け入れ条件) | 機能要件・完成条件 | 何ができればOKか | 個別ストーリー |

**重要な関係性:**
- ストーリーが「完成」とみなされるには、**DoD (完成の定義) を満たす必要がある**
- DoDの必須条件の一つとして、**「すべての受け入れ条件 (AC) が満たされていること」が含まれる**
- つまり、DoD は絶対的な条件であり、ACはDoDの一要素として位置づけられる

**例:**

- **ストーリーカード**: "投票参加者は、自分の見積もりを投票したい。チームメンバーに自分の意見を伝えるために。"
- **DoD**: "すべての受け入れ条件 (AC) が満たされている" / "ユニットテストが追加されている" / "コードレビューが完了している" / "ドキュメントが更新されている"
- **AC**: "投票ボタンをクリックすると投票が記録される" / "投票後は他の参加者には投票済みステータスのみ表示される"

---

## ストーリーカードの位置づけ

### ユーザーストーリーにおけるストーリーカードの役割

ストーリーカードは、**ユーザーストーリーを記述するための記法・情報**である。

**重要な理解:**
- **ユーザーストーリー** (または PBI: Product Backlog Item) は、開発時に管理される単位である
- **ストーリーカード**は、その中に含まれる「誰が・何を・なぜ」を表現する記法である
- ストーリーカード自体を単体で管理することはなく、常にユーザーストーリー/PBI の一部として扱う

### プロダクトバックログにおける用語の階層

```
プロダクトバックログ
  └── PBI (Product Backlog Item) / チケット
        ├── ユーザーストーリー
        │     └── ストーリーカード (記法・情報)
        ├── バグ修正
        ├── スパイク
        └── タスク
```

---

## ストーリーカードのフォーマット要素

### 基本フォーマット

```
{role} は、 {action} したい。 {benefit} (の) ために。
```

各プレースホルダーと半角スペース、句読点の位置は固定である。

### 各要素の定義

#### {role}: ユーザーロール

ユーザーロールは、単なる「ユーザー分類」ではなく、**特定の状況に置かれた主役**を表す。

**基本原則:**
- ストーリーの主語となるユーザーの立場・役割を表す
- 定義済みユーザーロールリストから選択する (新規ロールの追加は仕様変更として扱う)
- カードの記述や開発時の揺れやブレを防ぐため、自由記述は許可しない
- 人・役職・権限名に限定されず、必要に応じて **when / where / condition (状況・文脈)** を含めてよい

**ロールの本質:**

ユーザーロールとは、特定の状況に置かれ、その状況特有の**痛み・期待・不安**を持ち、それによって**行動や判断が変わる主役**を表す。

**例:**
- 初回ユーザー (when を含む: 初めて使用する状況)
- 移動中のユーザー (where を含む: 移動中という場所的制約)
- 障害対応中の管理者 (condition を含む: 緊急対応という状況)

これらは、それぞれ異なる期待や切迫感を持ち、優先順位や要件が変わるため、ロールとして扱う理由がある。

#### {action}: 実現したいこと

- ユーザーが行いたい行動や操作を動詞形式で記述する
- 具体的かつ明確に、ユーザー視点で記述する
- 実装手段ではなく、ユーザーの意図を記述する

#### {benefit}: 理由・価値

- なぜそれを行いたいのか、その背景にある理由や得られる価値を記述する
- ビジネス価値、ユーザー体験の向上、問題解決など、その機能がもたらす本質的な価値を明確にする
- この要素により、実装の優先順位や方法の判断が可能になる

---

## 完成の定義 (DoD: Definition of Done)

### 完成の定義とは

完成の定義 (DoD: Definition of Done) は、**すべてのユーザーストーリーに共通して適用される品質基準**である。

**基本原則:**
- プロジェクトまたはチーム全体で合意された「完成」の基準
- すべてのストーリーに一律に適用される
- 個別ストーリーの受け入れ条件 (AC) とは独立して管理される
- 品質の一貫性を保証する

### DoDの役割

#### 1. 品質の一貫性確保

- すべてのストーリーが同じ品質基準を満たす
- 「完成」の認識がチーム内で統一される
- 技術的負債の蓄積を防ぐ

#### 2. プロセスの標準化

- 開発、テスト、レビュー、デプロイなどのプロセスを標準化
- チームメンバー間での作業品質のばらつきを減らす
- 新メンバーのオンボーディングを容易にする

#### 3. 透明性の向上

- 「完成」の意味がステークホルダーに明確に伝わる
- 関係者が安心して受け入れられる
- レビュー時の混乱を防ぐ

### DoDの具体例

#### 基本的なDoD

```
完成の定義 (DoD):
- [ ] コードが実装され、動作する
- [ ] ユニットテストが追加され、すべてのテストが成功している
- [ ] コードレビューが完了し、承認されている
- [ ] 受け入れ条件 (AC) がすべて満たされている
- [ ] コードが mainブランチにマージされている
- [ ] ドキュメントが更新されている (必要な場合)
```

#### より厳格なDoD

```
完成の定義 (DoD):
- [ ] コードが実装され、動作する
- [ ] ユニットテストが追加され、カバレッジが80%以上
- [ ] 統合テストが追加され、すべてのテストが成功している
- [ ] コードレビューが完了し、2名以上の承認を得ている
- [ ] 静的解析ツールでエラーが0件
- [ ] セキュリティスキャンで脆弱性が検出されていない
- [ ] 受け入れ条件 (AC) がすべて満たされている
- [ ] パフォーマンス基準を満たしている
- [ ] アクセシビリティ基準 (WCAG 2.1 AA) を満たしている
- [ ] コードが mainブランチにマージされている
- [ ] ステージング環境にデプロイされている
- [ ] ドキュメントが更新されている
- [ ] リリースノートが記載されている
```

### DoDの運用

#### 1. チーム全体で合意

- DoDはチーム全員が参加して定義する
- 開発者、QA、デザイナーなど、すべての役割が納得する内容にする
- 定期的に見直し、プロジェクトの成熟度に応じて更新する

#### 2. 現実的な基準設定

- 達成不可能な基準は避ける
- チームのスキルレベルやプロジェクトのフェーズに応じて調整する
- 初期は基本的なDoDから始め、段階的に厳格化する

#### 3. 継続的な改善

- 定期的な振り返りでDoDを見直す
- 問題が繰り返し発生する場合は、DoDに項目を追加する
- 不要になった項目は削除または調整する

#### 4. 可視化と共有

- DoDをチーム全員が見える場所に掲示する
- 新メンバーには必ずDoDを説明する
- ストーリーの完成判定時には必ずDoDを参照する

### DoDの段階的な進化

プロジェクトの成熟度に応じて、DoDを進化させる：

#### フェーズ1: 最小限のDoD (プロジェクト初期)

```
- [ ] コードが実装され、動作する
- [ ] 受け入れ条件 (AC) が満たされている
- [ ] コードレビューが完了している
```

#### フェーズ2: 標準的なDoD (チームが安定)

```
- [ ] コードが実装され、動作する
- [ ] ユニットテストが追加されている
- [ ] 受け入れ条件 (AC) が満たされている
- [ ] コードレビューが完了している
- [ ] mainブランチにマージされている
```

#### フェーズ3: 成熟したDoD (継続的デリバリー)

```
- [ ] コードが実装され、動作する
- [ ] ユニットテストと統合テストが追加されている
- [ ] カバレッジ基準を満たしている
- [ ] 受け入れ条件 (AC) が満たされている
- [ ] コードレビューと承認が完了している
- [ ] 静的解析とセキュリティスキャンを通過している
- [ ] mainブランチにマージされている
- [ ] 本番環境にデプロイ可能な状態になっている
```

### DoDとACの関係性

DoDは**ストーリー横断の絶対的な完成基準**であり、ACはDoDの必須要素の一つである。

```
ユーザーストーリーの「完成」判定
  └── DoD (完成の定義) を満たす [絶対的条件]
        ├── 受け入れ条件 (AC) がすべて満たされている [DoD の必須要素]
        ├── ユニットテストが追加されている
        ├── コードレビューが完了している
        ├── mainブランチにマージされている
        └── その他のプロジェクト固有の品質基準
```

**重要な構造:**
- **DoD (完成の定義)** は、ストーリーが「完成」とみなされるための絶対的な条件である
- **AC (受け入れ条件)** は、DoDの必須条件の一つとして位置づけられる
- ストーリーが完成するには、「すべてのACが満たされていること」を含む、DoDのすべての条件を満たす必要がある
- ACを満たしても、DoDの他の条件（テスト、レビュー等）を満たしていなければ「未完成」である

---
## 受け入れ条件 (AC: Acceptance Criteria)

### 受け入れ条件とは

受け入れ条件 (AC: Acceptance Criteria) は、**ユーザーストーリーが完成したと判断するための具体的な条件**を定義する。

**基本原則:**
- ストーリーカードが「なぜ・何を」を示すのに対し、ACは「どのような条件を満たせば完成か」を明確にする
- 各ユーザーストーリーに固有の条件を記述する
- 検証可能で明確な条件として定義する
- 開発者とビジネス側が合意する受け入れテストの基準となる

### ACの役割

#### 1. スコープの明確化

- 何を実装すべきか、何を実装すべきでないかを明確にする
- 開発の範囲を限定し、スコープクリープを防ぐ
- チーム内で「完成」の認識を統一する

#### 2. 受け入れテストの基準

- ビジネス側が受け入れる際の判断基準となる
- 受け入れテストのテストケースの元となる
- 自動テストの要件定義としても活用できる

#### 3. コミュニケーションツール

- 開発者、ビジネス側、QAが共通認識を持つための基盤
- 曖昧さを排除し、議論の土台を提供する

### ACの記述形式

#### 形式1: チェックリスト形式

シンプルで明確な条件を列挙する形式。最も一般的で使いやすい。

```
受け入れ条件:
- [ ] ユーザーが投票ボタンをクリックすると、投票が記録される
- [ ] 投票後、自分の投票内容が表示される
- [ ] 投票後、他の参加者には「投票済み」ステータスのみが表示される
- [ ] すべての参加者が投票するまで、個別の投票内容は表示されない
```

#### 形式2: Given-When-Then 形式

振る舞い駆動開発 (BDD) で使用される形式。シナリオベースで記述する。

```
シナリオ: 参加者が投票を行う
  Given 参加者がテーブルに参加している
  And 投票ラウンドが開始されている
  When 参加者が「5」を選択して投票ボタンをクリックする
  Then 投票が記録される
  And 参加者には自分の投票「5」が表示される
  And 他の参加者には「投票済み」ステータスのみが表示される
```

#### 形式3: ルールベース形式

複雑なビジネスルールや条件分岐がある場合に使用する。

```
受け入れ条件:
- 投票権限: Voterロールの参加者のみ投票できる
- 投票タイミング: ラウンド開始後、公開前まで投票可能
- 投票変更: 公開前であれば投票を変更可能
- 公開条件: すべてのVoterが投票完了、または運営者が強制公開
- 表示制御: 公開前は自分の投票のみ表示、公開後はすべて表示
```

### ACのベストプラクティス

#### 1. 具体的で検証可能に

❌ 悪い例: "使いやすいUIにする"
✅ 良い例: "投票ボタンは画面中央に配置され、フォントサイズは16px以上とする"

#### 2. ユーザー視点で記述

❌ 悪い例: "データベースに投票レコードを保存する"
✅ 良い例: "投票後にページをリロードしても、投票内容が保持される"

#### 3. 過度に詳細にしない

- 実装の詳細ではなく、ユーザー視点での振る舞いに焦点を当てる
- 技術的な実装方法は AC ではなく、技術仕様や設計ドキュメントで扱う

#### 4. ストーリーカードとの対応

- AC はストーリーカードの {action} を具体化したもの
- {benefit} が達成されるための条件を明確にする

### ACとDoD (完成の定義) との関係

| 観点 | AC (受け入れ条件) | DoD (完成の定義) |
|------|------------------|------------------|
| スコープ | 個別ストーリー固有 | プロジェクト全体共通 (ストーリー横断) |
| 内容 | 機能要件・振る舞い | 品質基準・プロセス |
| 記述者 | PO + 開発チーム | チーム全体で合意 |
| 変更頻度 | ストーリーごと | プロジェクト単位 |
| 位置づけ | DoDの必須要素の一つ | 絶対的な完成基準 |
| 例 | "投票後に結果が表示される" | "すべてのACが満たされている" / "ユニットテストが追加されている" |

**重要な関係性:**
- **DoD (完成の定義)** は、ストーリーが「完成」とみなされるための絶対的な条件である
- **AC (受け入れ条件)** は、DoDの必須条件の一つとして位置づけられる
- 「すべての受け入れ条件 (AC) が満たされていること」は、DoDの必須項目として含まれる
- したがって、ACを満たさなければDoDを満たすことはできず、ストーリーは「未完成」となる

---
## ユーザーロール運用ガイドライン

### 目的

本ガイドラインは、ユーザーストーリーにおけるユーザーロール ({role}) を通じて、以下をチーム内で瞬時に共有できる状態を作ることを目的とする：

- **このストーリーは「誰の、どんな状況の課題か」**
- **なぜ今それが必要なのか**

その結果として、意味のない重複、似たようなストーリーの混在、判断のブレを避ける。

### 新しいユーザーロールを追加するかの判断基準

新しいユーザーロールを追加するかどうかは、**開発上の判断が変わるか**を軸に判断する。

#### 1. 優先順位の判断が変わるか

- 他のロールと比べて「後回しにできない」「先にやるべき」と判断が分かれるか
- 分かれるなら、ロールを分ける意味がある

#### 2. Action の質や要件が変わるか

- 同じ action 名でも、求められる速さ・分かりやすさ・安心感・失敗時の扱いが変わるか
- 変わるなら、別ロールとして扱う

#### 3. 「なぜそれが必要か」が変わるか

- 同じ機能でも、目的・背景・切実さが異なるか
- 異なるなら、同一ロールにまとめない

### ロールにしない判断

以下の場合は、新しいロールを作らない：

- 状況は違うが、優先順位・Action の要件・なぜ必要かが変わらない場合
- 単なる条件差・制約差であり、行動や判断に影響しない場合

これらはロールではなく、**受け入れ条件 (AC: Acceptance Criteria)** や**仕様上のケース分け**として扱う。

### 運用ルール

- ユーザーロールは事前定義リストから選択する
- 新規ロールを追加する場合は、上記判断基準に照らして検討する
- プロジェクトの仕様書の定義済みユーザーロールリストに追加し、仕様変更として扱う
- 迷った場合は、「この違いで、開発の判断は本当に変わるか？」に立ち戻る
- ユーザーストーリーは定期的に見直し、優先順位の再評価を行う
- エンドユーザーの価値を最大化することを常に念頭に置き、バックログの優先順位付けを行う

### 要点

- ユーザーロールは「人」ではなく**状況を伴う主役**
- 判断が変わるかどうかが、唯一の基準
- 変わらないなら、ロールではない

---

## PBI (Product Backlog Item) の概念

### PBI の定義

- **PBI (Product Backlog Item)** は、プロダクトバックログで管理される個別のアイテムを指す
- **チケット**とも呼ばれ、PBI とチケットは等価な関係にある
- 開発管理ツール (GitHub Issues、Jira など) で管理される単位

### PBI の種類

PBI は以下の種類を含む上位概念である：

#### 1. ユーザーストーリー (または単に「ストーリー」)

- ユーザー視点での機能要求を記述したもの
- ストーリーカードを含む
- プロダクト価値に直結する

#### 2. バグ修正

- 既存機能の不具合を修正するためのアイテム
- 再現手順、期待される動作、実際の動作などを含む

#### 3. スパイク

- 技術調査や検証を行うためのアイテム
- 不確実性を減らし、見積もり精度を向上させる目的

#### 4. タスク

- 技術的な作業やメンテナンス作業
- ユーザー価値に直結しない作業項目

### PBIs (複数形) とプロダクトバックログ

- **PBIs** (複数形) は、プロダクトバックログに含まれる複数のアイテムを指す
- プロダクトバックログそのものとほぼ等価な意味で用いられる
- 複数のアイテムを明確に指す場合に使用される

---

## 5W2H フレームワークとの関係性

### 5W2H フレームワーク

- **Who** (誰が): 主体・対象者
- **What** (何を): 内容・対象
- **When** (いつ): 時期・タイミング
- **Where** (どこで): 場所・環境
- **Why** (なぜ): 理由・目的
- **How** (どのように): 方法・手段
- **How much** (いくら / どのくらい): 量・程度・規模

### ストーリーカードフォーマットとの対応

```
{role} は、 {action} したい。 {benefit} (の) ために。
```

このフォーマットは以下の 5W2H 要素をカバーしている：

#### 1. {role} に含まれる要素

ユーザーロールは、単一の 5W2H 要素に対応するのではなく、**複数の要素を統合した概念**である：

- **Who (誰が)**: ロールの基本 - ユーザーの立場や役割
- **When (いつ)**: 必要に応じてロールに含める - 例: 「初回ユーザー」
- **Where (どこで)**: 必要に応じてロールに含める - 例: 「移動中のユーザー」「モバイルユーザー」
- **Condition (状況)**: 必要に応じてロールに含める - 例: 「障害対応中の管理者」

**重要な考え方:**

ロールは「人 (Who)」だけではなく、**その人が置かれた状況 (When/Where/Condition) を含めた主役**として定義する。これにより：

- 同じ人物でも、状況が異なれば優先順位や要件が変わることを表現できる
- 「開発者」と「移動中の開発者」は、異なる期待や制約を持つため、別ロールとして扱える
- 5W2H の複数要素を組み合わせることで、より正確に「誰の、どんな状況の課題か」を特定できる

#### 2. {action} = What (何を)

- 実現したいこと、行いたい行動を記述
- 動詞形式で具体的に表現
- 例: 「投票結果を一覧表示したい」
- **How (どのように)** や **How much (いくら / どのくらい)** の要素を含む場合がある
  - How の例: 「キーボードショートカットで素早く切り替えたい」(操作方法・プロセスの質)
  - How much の例: 「100件のレコードを一括で更新したい」(量・規模)
  - これらは行為そのものの体験や効率性を表す

#### 3. {benefit} = Why (なぜ)

- 理由・価値を記述
- ビジネス価値やユーザー体験の向上を明確化
- 例: 「チーム全体の見積もり傾向を把握するために」
- **How much (いくら / どのくらい)** の要素が理由・価値として表れる場合がある
  - 例: 「待ち時間なく次のタスクに取りかかるために」(時間効率による成果最適化)
  - これは行為の先にある目的や成果を表す

### 明示的に含まれない要素

ストーリーカードフォーマットは、5W2H のうち以下の要素を直接的には含まない：

- **When (いつ)** / **Where (どこで)**: {role} の一部として表現するか、実装の優先順位や開発計画で別途管理する
- **How (どのように)**: ユーザーが何かを行う具体的な方法・手段。{action} と部分的に重なるが、より詳細な手順やプロセスは**受け入れ条件 (AC: Acceptance Criteria)** や仕様として別途定義する
- **How much (いくら / どのくらい)**: ユーザーが望む量・程度・規模。例えば「どのくらいの速さで」「どれだけの量を」などの要件は、{action} や {benefit} に含めるか、非機能要件・**受け入れ条件 (AC: Acceptance Criteria)** として別途定義する

### フォーマット表記の検討

#### 代替案 1: 5W2H 要素を明示的に使用

```
Who: {role}, When: {when}, は、 What: {action} したい。 Why: {benefit} (の) ために。
```

- メリット: 各要素の対応が明確
- デメリット: 冗長で自然な日本語にならない、すべての要素が常に必要とは限らない

#### 代替案 2: 日本語の疑問詞表記

```
{誰が} は、 {何を} したい。 {なぜ} (の) ために。
```

- メリット: 意味が直感的に理解しやすい
- デメリット: 「誰がは」という不自然な表現、 when/where を含められない

#### 代替案 3: 業界標準プレースホルダー (採用)

```
{role} は、 {action} したい。 {benefit} (の) ために。
```

**メリット:**
- role/action/benefit は業界標準のプレースホルダーとして広く認識されている
- {role} に when/where/condition を柔軟に含められる
- 日本語として自然な文章構造を維持
- 読み手が内容に集中できる
- 定義済みリストと組み合わせることで一貫性を確保

**デメリット:**
- 初見では各要素の意味を説明する必要がある (ただし一度理解すれば解決)

### 採用理由

1. **柔軟性**: {role} が who だけでなく when/where/condition を含められることで、状況に応じた適切な表現が可能

2. **自然な日本語**: 「{role} は、 {action} したい。 {benefit} のために。」という文章構造は日本語として自然で読みやすい

3. **業界標準**: role/action/benefit は多くのアジャイル開発チームで使用されている標準的なプレースホルダー

4. **フォーカスの明確化**: ストーリーカードは Who (+ when/where/condition) / What / Why に絞ることで、ユーザー価値に集中できる

5. **実用性**: When/Where は {role} に統合し、How/How much は別の管理手段で扱うことで、適切な情報分離を実現

---

**本ドキュメントの位置づけ:**

本ドキュメントは、ユーザーストーリー駆動開発に関する一般的・汎用的な概念を定義している。ストーリーカード、完成の定義 (DoD)、受け入れ条件 (AC) などの基本概念と運用ガイドラインを提供し、プロジェクト全体の開発標準として機能する。プロジェクト固有のユーザーロール定義、優先順位付けルール、具体的なDoDの内容は、各プロジェクトの仕様書で定義される。
